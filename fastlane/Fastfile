# Fastlane é…ç½® for Echo
# ä½¿ç”¨æ–¹æ³•: fastlane beta

default_platform(:ios)

platform :ios do
  desc "Build and upload to TestFlight"
  lane :beta do
    # è·å–ç‰ˆæœ¬å·
    version = get_version_number(target: "EchoApp")
    build = get_build_number(target: "EchoApp")
    
    # æ„å»º iOS
    build_app(
      project: "Echo.xcodeproj",
      scheme: "Echo",
      configuration: "Release",
      export_method: "app-store",
      destination: "generic/platform=iOS"
    )
    
    # ä¸Šä¼ åˆ° TestFlight
    pilot(
      username: "guixiang123123@gmail.com",
      app_identifier: "com.xianggui.echo.app",
      skip_waiting_for_build_processing: true,
      skip_submission: false,
      distribute_external: false
    )
    
    puts "ğŸ‰ å·²ä¸Šä¼ åˆ° TestFlight! ç‰ˆæœ¬: #{version} (#{build})"
  end

  desc "Build for simulator (æµ‹è¯•ç”¨)"
  lane :sim do
    build_app(
      project: "Echo.xcodeproj",
      scheme: "Echo",
      configuration: "Debug",
      destination: "generic/platform=iOS Simulator",
      export_method: "simulator"
    )
    
    puts "âœ… Simulator æ„å»ºå®Œæˆ!"
  end
  
  desc "åŒæ­¥è¯ä¹¦å’Œæè¿°æ–‡ä»¶"
  lane :certs do
    match(
      type: "appstore",
      app_identifier: "com.xianggui.echo.app",
      readonly: false
    )
  end
end
